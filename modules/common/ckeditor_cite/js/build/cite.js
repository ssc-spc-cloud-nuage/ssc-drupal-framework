!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.cite=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{"use strict";i.d(s,{default:()=>v});var e=i("ckeditor5/src/core.js");function t(e,t,i,s){return s.createRange(o(e,t,i,!0,s),o(e,t,i,!1,s))}function o(e,t,i,s,o){let r=e.textNode||(s?e.nodeBefore:e.nodeAfter),n=null;for(;r&&r.getAttribute(t)==i;)n=r,r=s?r.previousSibling:r.nextSibling;return n?o.createPositionAt(n,s?"before":"after"):e}function r(e){return Array.from(e.getItems()).reduce(((e,t)=>t.is("text")||t.is("textProxy")?e+t.data:e),"")}var n=i("ckeditor5/src/utils.js");class a extends e.Command{refresh(){const e=this.editor.model,i=e.document.selection,s=i.getFirstRange();if(s.isCollapsed)if(i.hasAttribute("cite")){const s=i.getAttribute("cite"),o=t(i.getFirstPosition(),"cite",s,e);this.value={cite:r(o),title:s,range:o}}else this.value=null;else if(i.hasAttribute("cite")){const o=i.getAttribute("cite");t(i.getFirstPosition(),"cite",o,e).containsRange(s,!0)?this.value={cite:r(s),title:o,range:s}:this.value=null}else this.value=null;this.isEnabled=e.schema.checkAttributeInSelection(i,"cite")}execute({cite:e,title:t}){const i=this.editor.model,s=i.document.selection;i.change((o=>{if(s.isCollapsed){if(this.value){const{end:s}=i.insertContent(o.createText(e,{cite:t}),this.value.range);o.setSelection(s)}else if(""!==e){const r=s.getFirstPosition(),a=(0,n.toMap)(s.getAttributes());a.set("cite",t);const{end:l}=i.insertContent(o.createText(e,a),r);o.setSelection(l)}o.removeSelectionAttribute("cite")}else{const e=i.schema.getValidRanges(s.getRanges(),"cite");for(const i of e)o.setAttribute("cite",t,i)}}))}}class l extends a{refresh(){super.refresh(),this.isEnabled=!!this.value}execute(){const e=this.editor.model,i=e.document.selection;e.change((s=>{if(i.isCollapsed&&i.hasAttribute("cite")){const o=t(i.getFirstPosition(),"cite",i.getAttribute("cite"),e);s.removeAttribute("cite",o)}else{const t=e.schema.getValidRanges(i.getRanges(),"cite");for(const e of t)s.removeAttribute("cite",e)}}))}}class c extends e.Plugin{init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("addCite",new a(this.editor)),this.editor.commands.add("removeCite",new l(this.editor))}_defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:["cite"]})}_defineConverters(){const e=this.editor.conversion;e.for("downcast").attributeToElement({model:"cite",view:(e,t)=>{const{writer:i}=t;let s=e?{title:e}:null;return i.createAttributeElement("cite",s)}}),e.for("upcast").elementToAttribute({view:{name:"cite",attributes:["title"]},model:{key:"cite",value:e=>e.getAttribute("title")}})}}var u=i("ckeditor5/src/ui.js");class d extends u.View{constructor(t){super(t),this.focusTracker=new n.FocusTracker,this.keystrokes=new n.KeystrokeHandler,this.citeInputView=this._createInput(Drupal.t("Add cite")),this.titleInputView=this._createInput(Drupal.t("Add title")),this.saveButtonView=this._createButton(Drupal.t("Save"),e.icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(Drupal.t("Cancel"),e.icons.cancel,"ck-button-cancel"),this.cancelButtonView.delegate("execute").to(this,"cancel"),this.removeButtonView=this._createButton("Remove",e.icons.eraser,"ck-button-remove"),this.removeButtonView.delegate("execute").to(this,"remove"),this.childViews=this.createCollection([this.citeInputView,this.titleInputView,this.saveButtonView,this.cancelButtonView,this.removeButtonView]),this._focusCycler=new u.FocusCycler({focusables:this.childViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-cite-form"],tabindex:"-1"},children:this.childViews})}render(){super.render(),(0,u.submitHandler)({view:this}),this.childViews._items.forEach((e=>{this.focusTracker.add(e.element)})),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.citeInputView.isEnabled?this.citeInputView.focus():this.titleInputView.focus()}_createInput(e){const t=new u.LabeledFieldView(this.locale,u.createLabeledInputText);return t.label=e,t}_createButton(e,t,i){const s=new u.ButtonView;return s.set({label:e,icon:t,tooltip:!0,class:i}),s}}class b extends e.Plugin{static get requires(){return[u.ContextualBalloon]}init(){const e=this.editor;this._balloon=this.editor.plugins.get(u.ContextualBalloon),this.formView=this._createFormView();const t=e.commands.get("addCite");e.ui.componentFactory.add("cite",(e=>{const i=new u.ButtonView(e);return i.set({label:Drupal.t("Cite"),
  tooltip:!0,icon:'<?xml version="1.0" ?>' +
    '<svg version="1.1" viewBox="0 0 1600 1600" width="1280" height="1280" xmlns="http://www.w3.org/2000/svg">' +
    '<path transform="translate(846,21)" d="m0 0h27l75 6 31 4 28 5 39 9 29 8 28 11 36 16 25 13 19 12 17 12 18 13 13 10 10 8 10 9 25 25 7 8 12 13 11 14 8 10 12 17 11 18 8 13 12 21 11 24 15 40 8 26 9 36 7 34 6 34v8l-4 3-16 4-57 10-41 8-40 7-30 7h-6l-4-6-12-40-9-35-7-21-12-31-14-29-10-17-11-18-13-17-9-10-11-12-8-7-17-13-15-10-15-9-21-11-31-13-22-7-22-6-24-4-7-1-45-3h-27l-47 3-38 5-24 5-36 10-28 10-21 9-17 8-22 12-16 10-21 14-17 13-11 9-13 11-8 7-10 9-7 6-7 8-15 15-7 8-10 11-11 14-12 17-8 10-10 15-6 10-14 22-16 28-10 17-13 24-13 28-13 32-11 29-8 25-8 29-9 41-9 43-4 27-4 42-7 76v23l5 54 5 40 5 29 12 48 7 24 11 27 9 20 12 22 18 27 16 21 8 10 11 12 15 13 14 12 15 12 18 12 32 17 19 9 15 7 32 10 27 7 24 4 40 4 15 1h40l44-4 23-4 39-10 24-8 25-11 34-17 20-12 26-17 14-10 11-9 10-9 9-8h2v-2l8-7 13-12 7-8 9-10 10-13 7-9 10-13 9-12 10-16 10-18 17-32 13-27 13-32 7-20 10-26 5-7 26 5 124 21 45 8 5 2-1 4-10 23-13 32-12 29-13 30-19 38-7 12-6 11-9 16-10 17-9 15-20 30-11 14-11 13-9 11-11 13-8 10-12 14-18 18-8 7-15 13-12 11-11 9-15 13-17 13-19 13-15 10-17 11-16 10-22 12-30 14-36 15-36 12-37 10-41 9-28 5-36 4-26 2-26 1h-30l-36-2-37-4-41-7-27-6-31-8-25-8-23-8-27-12-16-8-22-12-17-11-16-10-19-14-17-14-11-9-9-9-8-7-16-16v-2h-2l-7-8-9-10-12-14-9-11-14-19-10-15-15-25-15-28-13-28-8-20-14-39-12-43-6-26-7-38-5-39-3-40-4-76v-23l4-85 3-33 8-55 7-43 8-39 10-39 10-33 12-36 12-30 16-37 8-17 10-19 13-25 12-21 12-20 10-16 20-30 11-16 8-11 12-14 9-11 12-14 7-9 5-6h2l2-4 9-9 7-8 9-10 11-12 17-17 8-7 13-11 14-12 25-20 16-11 27-18 15-9 23-13 15-8 23-11 23-10 36-14 30-10 44-12 28-5 38-5 31-3z"/>' +
    '<path transform="translate(638,1598)" d="m0 0h44l1 2h-46z"/>' +
    '<path transform="translate(687,1599)" d="m0 0 3 1z"/>' +
    '<path transform="translate(684,1599)" d="m0 0 2 1z"/>' +
    '</svg>\n'}),this.listenTo(i,"execute",(()=>{this._showUI()})),i.bind("isOn","isEnabled").to(t,"value","isEnabled"),i}))}_createFormView(){const e=this.editor,t=new d(e.locale);return this.listenTo(t,"submit",(()=>{const i={cite:t.citeInputView.fieldView.element.value,title:t.titleInputView.fieldView.element.value};e.execute("addCite",i),this._hideUI()})),this.listenTo(t,"remove",(()=>{e.execute("removeCite"),this._hideUI()})),this.listenTo(t,"cancel",(()=>{this._hideUI()})),(0,u.clickOutsideHandler)({emitter:t,activator:()=>this._balloon.visibleView===t,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),t}_showUI(){const e=this.editor.model.document.selection,t=this.editor.commands.get("addCite").value;if(this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.removeButtonView.isEnabled=!!t,this.formView.citeInputView.isEnabled=e.getFirstRange().isCollapsed,t)this.formView.citeInputView.fieldView.value=t.cite,this.formView.titleInputView.fieldView.value=t.title;else{const t=r(e.getFirstRange());this.formView.citeInputView.fieldView.value=t,this.formView.titleInputView.fieldView.value=""}this.formView.focus()}_hideUI(){this.formView.citeInputView.fieldView.value="",this.formView.titleInputView.fieldView.value="",this.formView.element.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;let i=null;return i=()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange()),{target:i}}}class h extends e.Plugin{static get requires(){return[c,b]}}const v={Cite:h}})(),s=s.default})()));
